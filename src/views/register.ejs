<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Registrace</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<script>
    function editField(field) {
        const displayElement = document.getElementById(field + 'Display');
        const currentValue = displayElement.innerText;

        displayElement.innerHTML = `
        <input type="text" id="${field}Input" class="inline-edit-input" value="${currentValue}" oninput="validateInput('${field}')" />
        <button id="${field}SaveBtn" onclick="saveField('${field}')" class="inline-edit-button" disabled>Uložit</button>
        <p id="${field}Error" class="error-message"></p>
        `;
    }

    function validateInput(field) {
        const inputElement = document.getElementById(`${field}Input`);
        const saveButton = document.getElementById(`${field}SaveBtn`);
        const errorMessage = document.getElementById(`${field}Error`);
        const newValue = inputElement.value;

        let isValid = false;


        if (field === 'name') {
            if (newValue.length < 3 || newValue.length > 25) {
                errorMessage.innerText = '❌ Jméno musí mít 3 až 25 znaků.';
                inputElement.classList.add('input-error');
                inputElement.classList.remove('input-valid');
            } else {
                isValid = true;
                errorMessage.innerText = '';
                inputElement.classList.remove('input-error');
                inputElement.classList.add('input-valid');
            }
        } else if (field === 'email') {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(newValue) ) {
                errorMessage.innerText = '❌ Zadejte platný email.';
                inputElement.classList.add('input-error');
                inputElement.classList.remove('input-valid');
            } else {
                isValid = true;
                errorMessage.innerText = '';
                inputElement.classList.remove('input-error');
                inputElement.classList.add('input-valid');
            }
        }

        // ✅ Povolit nebo zakázat tlačítko podle validace
        saveButton.disabled = !isValid;
    }


    function saveField(field) {
        const newValue = document.getElementById(field + 'Input').value;
        fetch('/account/edit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                field: field,
                value: newValue  // Nová hodnota
            })
        })
            .then(response => {
                if (response.ok) {
                    document.getElementById(field + 'Display').innerText = newValue;
                    alert('✅ Údaj byl úspěšně změněn.');
                } else {
                    alert('❌ Chyba při ukládání. Zkuste to znovu.');
                }
            })
            .catch(error => {
                console.error('❌ Chyba při komunikaci se serverem:', error);
                alert('❌ Nastala chyba při odesílání dat.');
            });
    }

</script>
<body>
    <%- include('partials/navbar') %>

    <div class="auth-wrapper">
       

        <!-- ✅ Zobrazení chybové zprávy -->
        <% if (typeof error !== 'undefined') { %>
            <div class="error-message">
                <%= error %>
            </div>
        <% } %>

        <form action="/keyboard/auth/register" method="POST" class="auth-form">
            <input type="text" name="name" placeholder="Jméno" class="auth-input" value="<%= typeof name !== 'undefined' ? name : '' %>" required><br>
            <input type="email" name="email" placeholder="Email" class="auth-input" value="<%= typeof email !== 'undefined' ? email : '' %>" required><br>
            <input type="password" name="password" placeholder="Heslo" class="auth-input" required><br>
            <button type="submit" class="auth-button">Registrovat</button>
        </form>

        <a href="/keyboard/auth/login" class="auth-link">Máte už účet? Přihlaste se.</a>
    </div>
</body>
</html>
